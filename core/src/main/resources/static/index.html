<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <title>Formation App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;line-height:1.4}
        h1{margin-top:0}
        input,button,textarea{font:inherit;padding:.5rem}
        .row{display:flex;gap:.5rem;flex-wrap:wrap}
        .card{border:1px solid #ddd;border-radius:12px;padding:16px;margin:12px 0}
        code{background:#f6f8fa;padding:.2rem .4rem;border-radius:6px}
        table{border-collapse:collapse;width:100%} th,td{border:1px solid #eee;padding:.5rem;text-align:left}
    </style>
</head>
<body>
<h1>Formation App</h1>

<div class="card">
    <h3>Liens utiles</h3>
    <ul>
        <li><a href="/formation/health" target="_blank">/formation/health</a></li>
        <li><a href="/formation/h2-console" target="_blank">/formation/h2-console</a> (URL JDBC : <code>jdbc:h2:mem:testdb</code>, user <code>sa</code>, mdp vide)</li>
        <li><a href="/formation/formations" target="_blank">/formation/formations (GET)</a></li>
    </ul>
</div>

<div class="card">
    <h3>Créer une formation</h3>
    <div class="row">
        <input id="title" placeholder="Titre" />
        <input id="desc"  placeholder="Description" />
        <button id="createBtn">Créer</button>
    </div>
    <small>POST vers <code>/formation/formations</code></small>
</div>

<div class="card">
    <h3>Formations</h3>
    <button id="refreshBtn">Rafraîchir</button>
    <div id="list"></div>
</div>

<script>
    const base = '/formation';
    const $ = s => document.querySelector(s);

    async function list() {
      const res = await fetch(`${base}/formations`);
      const data = await res.json();
      const rows = data.map(f =>
        `<tr>
           <td>${f.id ?? ''}</td>
           <td>${f.title ?? ''}</td>
           <td>${f.description ?? ''}</td>
           <td><button data-id="${f.id}" class="del">Supprimer</button></td>
         </tr>`
      ).join('');
      $("#list").innerHTML =
        `<table>
           <thead><tr><th>ID</th><th>Titre</th><th>Description</th><th></th></tr></thead>
           <tbody>${rows}</tbody>
         </table>`;
      document.querySelectorAll('.del').forEach(b => b.onclick = del);
    }

    async function create() {
      const body = {
        title: $("#title").value.trim(),
        description: $("#desc").value.trim(),
        participants: []
      };
      if (!body.title) return alert("Titre requis");
      const res = await fetch(`${base}/formations`, {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(body)
      });
      if (!res.ok) return alert('Erreur création');
      $("#title").value = ''; $("#desc").value = '';
      await list();
    }

    async function del(e){
      const id = e.target.getAttribute('data-id');
      if (!id) return;
      if (!confirm('Supprimer ?')) return;
      const res = await fetch(`${base}/formations/${id}`, { method:'DELETE' });
      if (!res.ok && res.status !== 204) return alert('Erreur suppression');
      await list();
    }

    $("#createBtn").onclick = create;
    $("#refreshBtn").onclick = list;
    list();
</script>
</body>
</html>
